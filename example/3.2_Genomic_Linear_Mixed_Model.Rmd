---
title: "3.2_Genomic_Linear_Mixed_Model"
author: "Tianjing Zhao"
date: "August 27, 2018"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Install package
```{r}
library(devtools)
install_github("zhaotianjing/JWASr")
```
### load package
```{r}
library("JWASr")
```
### set up (windows user)
```{r}
path_libjulia = "C:/Users/ztjsw/AppData/Local/Julia-0.7.0/bin/libjulia.dll"
jwasr_setup_win(path_libjulia)
```
For Mac user, run one line "JWASr::jwasr_setup()" to setup.


### data
```{r}
phenotypes = phenotypes  #build-in data

ped_path = "D:\\JWASr\\data\\pedigree.txt"
get_pedigree(ped_path, separator=',', header=T)  #build "pedigree" in Julia
```

### build model
```{r}
model_equation ="y1 = intercept + x1 + x3 + ID + dam
                  y2 = intercept + x1 + x2 + x3 + ID
                  y3 = intercept + x1 + x1*x3 + x2 + ID"
R = diag(3)
model = build_model(model_equation, R)
```

### set covariate
```{r}
set_covariate("x1")
```

### set random
```{r}
G1 = diag(2)
set_random("x2",G1)
```
```{r}
G2 = diag(4)
set_random("ID dam", G2, pedigree = TRUE)
```

### add genotypes
```{r}
G3 = diag(3)
geno_path = "D:/JWASr/data/genotypes.txt"

add_genotypes(geno_path, G3)  #separator=',' is default
```


### run
```{r}
outputMCMCsamples("x2")
out = runMCMC(data = phenotypes, methods = "BayesC", estimatePi = TRUE, chain_length = 5000, output_samples_frequency = 100)
```

### select result "Posterior mean of Pi"
```{r}
 out$`Posterior mean of Pi`
```

### all results
```{r}
out
```
