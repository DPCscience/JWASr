4.2\_SSBR
================
Tianjing Zhao
August 28, 2018

### Install package

``` r
library(devtools)
install_github("zhaotianjing/JWASr")
```

    ## Downloading GitHub repo zhaotianjing/JWASr@master
    ## from URL https://api.github.com/repos/zhaotianjing/JWASr/zipball/master

    ## Installing JWASr

    ## "C:/PROGRA~1/R/R-35~1.1/bin/x64/R" --no-site-file --no-environ --no-save  \
    ##   --no-restore --quiet CMD INSTALL  \
    ##   "C:/Users/ztjsw/AppData/Local/Temp/RtmpKkqebr/devtools5e60f86793f/zhaotianjing-JWASr-b5b6531"  \
    ##   --library="C:/Users/ztjsw/Documents/R/win-library/3.5" --install-tests

    ## 

### set up (windows user)

``` r
path_libjulia = "C:/Users/ztjsw/AppData/Local/Julia-0.7.0/bin/libjulia.dll"
JWASr::jwasr_setup_win(path_libjulia)
```

    ## Julia version 0.7.0 at location C:\Users\ztjsw\AppData\Local\JULIA-~2.0\bin will be used.

    ## Loading setup script for JuliaCall...

    ## Finish loading setup script for JuliaCall.

For Mac user, run one line "JWASr::jwasr\_setup()" to setup.

### data

``` r
phenotypes = JWASr::phenotypes

ped_path = "D:\\JWASr\\data\\pedigree.txt"
JWASr::get_pedigree(ped_path, separator=',', header=T)  #build "pedigree" in Julia
```

    ## JWAS.PedModule.Pedigree(13, Dict{AbstractString,JWAS.PedModule.PedNode}("a2"=>PedNode(1, "0", "0", 0.0),"a1"=>PedNode(2, "0", "0", 0.0),"a7"=>PedNode(4, "a1", "a3", 0.0),"a12"=>PedNode(10, "a9", "a10", 0.1875),"a5"=>PedNode(8, "a1", "a2", 0.0),"a3"=>PedNode(3, "0", "0", 0.0),"a4"=>PedNode(5, "a1", "a2", 0.0),"a6"=>PedNode(6, "a1", "a3", 0.0),"a10"=>PedNode(9, "a5", "a7", 0.125),"a11"=>PedNode(11, "a9", "a10", 0.1875)), Dict(32=>0.25,2=>0.0,16=>0.0,11=>0.5,7=>0.0,9=>0.5,25=>0.375,35=>0.375,43=>0.375,19=>0.5), Set(Any[]), Set(Any[]), Set(Any[]), Set(Any[]))

### build model

``` r
model_equation ="y1 = intercept + x1 + x3 + ID + dam
                  y2 = intercept + x1 + x2 + x3 + ID
                  y3 = intercept + x1 + x1*x3 + x2 + ID"
R = diag(3)
model = JWASr::build_model(model_equation,R) #build "model" in Julia
```

### set covariate

``` r
JWASr::ran_julia('set_covariate(model,"x1")')
```

    ## 1-element Array{Symbol,1}:
    ##  :x1

### set random

``` r
JWASr::assign("G1", diag(2))
JWASr::ran_julia('set_random(model, "x2", G1)')
```

``` r
JWASr::assign("G2",diag(4))
JWASr::ran_julia('set_random(model,"ID dam",pedigree,G2)')
```

### add genotypes

``` r
G3 = diag(3)
geno_path = "D:/JWASr/data/genotypes.txt"

JWASr::add_genotypes(geno_path, G3)  #separator=',' is default
```

### run

``` r
out = JWASr::runMCMC(data = phenotypes, methods = "BayesC", estimatePi = TRUE, single_step_analysis = TRUE,
                     pedigree = TRUE, chain_length = 5000, output_samples_frequency = 100)  #pedigree=TRUE: pedigree; FALSE: false
```

### select result

``` r
out$`Posterior mean of marker effects`
```

    ## [[1]]
    ##      [,1] [,2]      
    ## [1,] "m1" -0.6670252
    ## [2,] "m2" -0.3599106
    ## [3,] "m3" 0.9596757 
    ## [4,] "m4" 0.3518072 
    ## [5,] "m5" 0.4963397 
    ## 
    ## [[2]]
    ##      [,1] [,2]      
    ## [1,] "m1" 0.9156003 
    ## [2,] "m2" 0.228199  
    ## [3,] "m3" -0.4025728
    ## [4,] "m4" -0.2047943
    ## [5,] "m5" -0.3241493
    ## 
    ## [[3]]
    ##      [,1] [,2]       
    ## [1,] "m1" 0.09815955 
    ## [2,] "m2" -0.1273531 
    ## [3,] "m3" -0.1966285 
    ## [4,] "m4" -0.06680637
    ## [5,] "m5" -0.03287062

### all result

``` r
out
```

    ## $`Posterior mean of polygenic effects covariance matrix`
    ##               [,1]        [,2]          [,3]        [,4]
    ## [1,]  1.0984467830 -0.33858387  0.0006158176  0.00904983
    ## [2,] -0.3385838713  1.10753375 -0.0321146162  0.02817737
    ## [3,]  0.0006158176 -0.03211462  0.7606689967 -0.01510840
    ## [4,]  0.0090498305  0.02817737 -0.0151084014  0.78329947
    ## 
    ## $`Model frequency`
    ## Julia Object of type Array{Array{Float64,1},1}.
    ## Array{Float64,1}[[0.6904, 0.6058, 0.8188, 0.616, 0.6606], [0.799, 0.5482, 0.6038, 0.5516, 0.61], [0.4188, 0.4908, 0.486, 0.4404, 0.449]]
    ## $`Posterior mean of marker effects`
    ## $`Posterior mean of marker effects`[[1]]
    ##      [,1] [,2]      
    ## [1,] "m1" -0.6670252
    ## [2,] "m2" -0.3599106
    ## [3,] "m3" 0.9596757 
    ## [4,] "m4" 0.3518072 
    ## [5,] "m5" 0.4963397 
    ## 
    ## $`Posterior mean of marker effects`[[2]]
    ##      [,1] [,2]      
    ## [1,] "m1" 0.9156003 
    ## [2,] "m2" 0.228199  
    ## [3,] "m3" -0.4025728
    ## [4,] "m4" -0.2047943
    ## [5,] "m5" -0.3241493
    ## 
    ## $`Posterior mean of marker effects`[[3]]
    ##      [,1] [,2]       
    ## [1,] "m1" 0.09815955 
    ## [2,] "m2" -0.1273531 
    ## [3,] "m3" -0.1966285 
    ## [4,] "m4" -0.06680637
    ## [5,] "m5" -0.03287062
    ## 
    ## 
    ## $`Posterior mean of marker effects covariance matrix`
    ##             [,1]        [,2]        [,3]
    ## [1,]  0.94635185 -0.37322889 -0.05733883
    ## [2,] -0.37322889  0.77177012  0.03853415
    ## [3,] -0.05733883  0.03853415  0.48575726
    ## 
    ## $`Posterior mean of residual variance`
    ##             [,1]       [,2]        [,3]
    ## [1,]  0.81595042 -0.1741156  0.05024792
    ## [2,] -0.17411564  0.8921615 -0.10355614
    ## [3,]  0.05024792 -0.1035561  0.70253513
    ## 
    ## $`Posterior mean of marker effects variance`
    ##             [,1]        [,2]        [,3]
    ## [1,]  0.94635185 -0.37322889 -0.05733883
    ## [2,] -0.37322889  0.77177012  0.03853415
    ## [3,] -0.05733883  0.03853415  0.48575726
    ## 
    ## $`Posterior mean of location parameters`
    ##    Trait    Effect     Level    Estimate
    ## 1      1 intercept intercept  -0.4505968
    ## 2      1        x1        x1    1.095656
    ## 3      1        x3         m    2.111039
    ## 4      1        x3         f   0.5977657
    ## 5      1        ID        a2  0.05377867
    ## 6      1        ID       a12   0.1644064
    ## 7      1        ID       a10    0.565398
    ## 8      1        ID       a11   0.1237374
    ## 9      1        ID        a9   -0.294239
    ## 10     1        ID        a6  -0.1978875
    ## 11     1        ID        a7  0.04919429
    ## 12     1        ID        a3 -0.09328669
    ## 13     1        ID        a8  -0.8308197
    ## 14     1        ID        a1   0.0554816
    ## 15     1        ID        a5   0.5056818
    ## 16     1        ID        a4   -0.447318
    ## 17     1       dam        a2   0.2596222
    ## 18     1       dam       a12 -0.08950264
    ## 19     1       dam       a10 0.007369662
    ## 20     1       dam       a11  -0.1039952
    ## 21     1       dam        a9  -0.1823279
    ## 22     1       dam        a6  -0.3520614
    ## 23     1       dam        a7  0.01698168
    ## 24     1       dam        a3  -0.0902799
    ## 25     1       dam        a8  -0.1507687
    ## 26     1       dam        a1  -0.1687067
    ## 27     1       dam        a5  0.01979656
    ## 28     1       dam        a4  0.02453869
    ## 29     2 intercept intercept     22.1281
    ## 30     2        x1        x1  -0.1966207
    ## 31     2        x2         2 -0.02018696
    ## 32     2        x2         1 -0.08086294
    ## 33     2        x3         m   -18.21919
    ## 34     2        x3         f   -18.34977
    ## 35     2        ID        a2   0.5542542
    ## 36     2        ID       a12  0.08543141
    ## 37     2        ID       a10  -0.4884569
    ## 38     2        ID       a11  0.07351879
    ## 39     2        ID        a9   0.6604906
    ## 40     2        ID        a6  0.01249556
    ## 41     2        ID        a7  -0.1663237
    ## 42     2        ID        a3  -0.3700688
    ## 43     2        ID        a8   0.7607136
    ## 44     2        ID        a1   -0.167913
    ## 45     2        ID        a5 -0.05497562
    ## 46     2        ID        a4   0.7900571
    ## 47     3 intercept intercept    1.968592
    ## 48     3        x1        x1   -7.673558
    ## 49     3     x1*x3    x1 * m    7.232782
    ## 50     3     x1*x3    x1 * f    7.691015
    ## 51     3        x2         2  0.01557044
    ## 52     3        x2         1  0.07777156
    ## 53     3        ID        a2  -0.1228743
    ## 54     3        ID       a12 -0.06885162
    ## 55     3        ID       a10  -0.3064207
    ## 56     3        ID       a11 -0.06971547
    ## 57     3        ID        a9   0.1725105
    ## 58     3        ID        a6  0.02464692
    ## 59     3        ID        a7  -0.2864973
    ## 60     3        ID        a3   0.3543087
    ## 61     3        ID        a8  -0.3548837
    ## 62     3        ID        a1  -0.3611866
    ## 63     3        ID        a5  -0.4166753
    ## 64     3        ID        a4  -0.2747936
    ## 65     1  <U+03F5>        a2  0.07345378
    ## 66     1  <U+03F5>       a12   0.1479001
    ## 67     1  <U+03F5>       a10   0.1745811
    ## 68     1  <U+03F5>       a11   0.1258563
    ## 69     1  <U+03F5>        a9  0.09714003
    ## 70     2  <U+03F5>        a2  0.06134539
    ## 71     2  <U+03F5>       a12 -0.04102934
    ## 72     2  <U+03F5>       a10  -0.3496472
    ## 73     2  <U+03F5>       a11 -0.04049309
    ## 74     2  <U+03F5>        a9   0.2970145
    ## 75     3  <U+03F5>        a2  0.06457307
    ## 76     3  <U+03F5>       a12   0.2167628
    ## 77     3  <U+03F5>       a10   0.0211285
    ## 78     3  <U+03F5>       a11   0.1968213
    ## 79     3  <U+03F5>        a9   0.3869144
    ## 80     1         J         J    3.089221
    ## 81     2         J         J   -0.912519
    ## 82     3         J         J    2.355666
    ## 
    ## $`Posterior mean of Pi`
    ## $`Posterior mean of Pi`$`[1.0, 1.0, 0.0]`
    ## [1] 0.1712712
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 0.0, 0.0]`
    ## [1] 0.1042649
    ## 
    ## $`Posterior mean of Pi`$`[1.0, 0.0, 0.0]`
    ## [1] 0.1249813
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 1.0, 1.0]`
    ## [1] 0.1077542
    ## 
    ## $`Posterior mean of Pi`$`[1.0, 0.0, 1.0]`
    ## [1] 0.1192161
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 0.0, 1.0]`
    ## [1] 0.1058851
    ## 
    ## $`Posterior mean of Pi`$`[1.0, 1.0, 1.0]`
    ## [1] 0.151963
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 1.0, 0.0]`
    ## [1] 0.1146642
