4.2\_SSBR
================
Tianjing Zhao
August 28, 2018

### Install package

``` r
library(devtools)
install_github("zhaotianjing/JWASr")
```

    ## Skipping install of 'JWASr' from a github remote, the SHA1 (74292d8b) has not changed since last install.
    ##   Use `force = TRUE` to force installation

### load package

``` r
library("JWASr")
```

    ## 
    ## Attaching package: 'JWASr'

    ## The following object is masked from 'package:base':
    ## 
    ##     assign

### set up (windows user)

``` r
path_libjulia = "C:/Users/ztjsw/AppData/Local/Julia-0.7.0/bin/libjulia.dll"
jwasr_setup_win(path_libjulia)
```

    ## Julia version 0.7.0 at location C:\Users\ztjsw\AppData\Local\JULIA-~2.0\bin will be used.

    ## Loading setup script for JuliaCall...

    ## Finish loading setup script for JuliaCall.

For Mac user, run one line "JWASr::jwasr\_setup()" to setup.

### data

``` r
phenotypes = phenotypes  #build-in data

ped_path = "D:\\JWASr\\data\\pedigree.txt"
get_pedigree(ped_path, separator=',', header=T)  #build "pedigree" in Julia
```

    ## JWAS.PedModule.Pedigree(13, Dict{AbstractString,JWAS.PedModule.PedNode}("a2"=>PedNode(1, "0", "0", 0.0),"a1"=>PedNode(2, "0", "0", 0.0),"a7"=>PedNode(4, "a1", "a3", 0.0),"a12"=>PedNode(10, "a9", "a10", 0.1875),"a5"=>PedNode(8, "a1", "a2", 0.0),"a3"=>PedNode(3, "0", "0", 0.0),"a4"=>PedNode(5, "a1", "a2", 0.0),"a6"=>PedNode(6, "a1", "a3", 0.0),"a10"=>PedNode(9, "a5", "a7", 0.125),"a11"=>PedNode(11, "a9", "a10", 0.1875)), Dict(32=>0.25,2=>0.0,16=>0.0,11=>0.5,7=>0.0,9=>0.5,25=>0.375,35=>0.375,43=>0.375,19=>0.5), Set(Any[]), Set(Any[]), Set(Any[]), Set(Any[]))

### build model

``` r
model_equation ="y1 = intercept + x1 + x3 + ID + dam
                  y2 = intercept + x1 + x2 + x3 + ID
                  y3 = intercept + x1 + x1*x3 + x2 + ID"
R = diag(3)
build_model(model_equation, R) #build "model" in Julia
```

    ## Julia Object of type JWAS.MME.
    ## JWAS.MME(3, AbstractString["y1 = intercept + x1 + x3 + ID + dam", "y2 = intercept + x1 + x2 + x3 + ID", "y3 = intercept + x1 + x1*x3 + x2 + ID"], JWAS.ModelTerm[ModelTerm(1, "1:intercept", 1, Symbol[:intercept], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(1, "1:x1", 1, Symbol[:x1], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(1, "1:x3", 1, Symbol[:x3], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(1, "1:ID", 1, Symbol[:ID], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(1, "1:dam", 1, Symbol[:dam], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(2, "2:intercept", 1, Symbol[:intercept], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(2, "2:x1", 1, Symbol[:x1], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(2, "2:x2", 1, Symbol[:x2], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(2, "2:x3", 1, Symbol[:x3], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(2, "2:ID", 1, Symbol[:ID], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(3, "3:intercept", 1, Symbol[:intercept], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(3, "3:x1", 1, Symbol[:x1], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(3, "3:x1*x3", 2, Symbol[:x1, :x3], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(3, "3:x2", 1, Symbol[:x2], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries), ModelTerm(3, "3:ID", 1, Symbol[:ID], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries)], Dict{AbstractString,JWAS.ModelTerm}("1:ID"=>ModelTerm(1, "1:ID", 1, Symbol[:ID], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"2:x3"=>ModelTerm(2, "2:x3", 1, Symbol[:x3], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"2:x1"=>ModelTerm(2, "2:x1", 1, Symbol[:x1], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"3:ID"=>ModelTerm(3, "3:ID", 1, Symbol[:ID], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"2:x2"=>ModelTerm(2, "2:x2", 1, Symbol[:x2], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"1:intercept"=>ModelTerm(1, "1:intercept", 1, Symbol[:intercept], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"1:x1"=>ModelTerm(1, "1:x1", 1, Symbol[:x1], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"3:x2"=>ModelTerm(3, "3:x2", 1, Symbol[:x2], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"2:intercept"=>ModelTerm(2, "2:intercept", 1, Symbol[:intercept], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries),"3:x1*x3"=>ModelTerm(3, "3:x1*x3", 2, Symbol[:x1, :x3], AbstractString[], Float64[], 0, Any[], 0, 0×0 SparseMatrixCSC{Float64,Int64} with 0 stored entries)), Symbol[:y1, :y2, :y3], Symbol[], 0, 0, AbstractString[], 0, 0, 0, 0, 0, [0.0], [0.0], [0.0], JWAS.RandomEffect[], [1.0 0.0 0.0; 0.0 1.0 0.0; 0.0 0.0 1.0], 0, 0, 0.0, 0.0, 0, 1, [0.0], [0.0], JWAS.MCMCSamples[], JWAS.DF(4.0, 4.0, 4.0, 4.0), 0, 0, Dict{String,Any}(), 0)

### set covariate

``` r
set_covariate("x1")
```

    ## Julia Object of type Array{Symbol,1}.
    ## Symbol[:x1]

### set random

``` r
G1 = diag(2)
set_random("x2", G1)
```

    ## NULL

``` r
G2 = diag(4)
set_random("ID dam", G2, pedigree = TRUE)
```

    ## NULL

### add genotypes

``` r
G3 = diag(3)
geno_path = "D:/JWASr/data/genotypes.txt"

add_genotypes(geno_path, G3)  #separator=',' is default
```

### run

``` r
out = runMCMC(data = phenotypes, methods = "BayesC", estimatePi = TRUE, single_step_analysis = TRUE,
                     pedigree = TRUE, chain_length = 5000, output_samples_frequency = 100)  #pedigree=TRUE: pedigree; FALSE: false
```

### select result

``` r
out$`Posterior mean of marker effects`
```

    ## [[1]]
    ##      [,1] [,2]      
    ## [1,] "m1" -0.7684226
    ## [2,] "m2" -0.4503485
    ## [3,] "m3" 0.8794711 
    ## [4,] "m4" 0.384619  
    ## [5,] "m5" 0.5083162 
    ## 
    ## [[2]]
    ##      [,1] [,2]      
    ## [1,] "m1" 0.6667685 
    ## [2,] "m2" 0.2139167 
    ## [3,] "m3" -0.4652649
    ## [4,] "m4" -0.1692604
    ## [5,] "m5" -0.2511694
    ## 
    ## [[3]]
    ##      [,1] [,2]       
    ## [1,] "m1" 0.1138279  
    ## [2,] "m2" -0.1585589 
    ## [3,] "m3" -0.2008508 
    ## [4,] "m4" -0.05889851
    ## [5,] "m5" -0.04203215

### all result

``` r
out
```

    ## $`Posterior mean of polygenic effects covariance matrix`
    ##             [,1]        [,2]        [,3]        [,4]
    ## [1,]  1.05717774 -0.33351238 -0.03474050 -0.03482462
    ## [2,] -0.33351238  1.09635743  0.01454255 -0.00505442
    ## [3,] -0.03474050  0.01454255  0.78179952 -0.01784712
    ## [4,] -0.03482462 -0.00505442 -0.01784712  0.77854151
    ## 
    ## $`Model frequency`
    ## Julia Object of type Array{Array{Float64,1},1}.
    ## Array{Float64,1}[[0.718, 0.634, 0.8182, 0.6328, 0.6562], [0.7186, 0.5496, 0.652, 0.5398, 0.562], [0.4492, 0.498, 0.5044, 0.4394, 0.4762]]
    ## $`Posterior mean of marker effects`
    ## $`Posterior mean of marker effects`[[1]]
    ##      [,1] [,2]      
    ## [1,] "m1" -0.7684226
    ## [2,] "m2" -0.4503485
    ## [3,] "m3" 0.8794711 
    ## [4,] "m4" 0.384619  
    ## [5,] "m5" 0.5083162 
    ## 
    ## $`Posterior mean of marker effects`[[2]]
    ##      [,1] [,2]      
    ## [1,] "m1" 0.6667685 
    ## [2,] "m2" 0.2139167 
    ## [3,] "m3" -0.4652649
    ## [4,] "m4" -0.1692604
    ## [5,] "m5" -0.2511694
    ## 
    ## $`Posterior mean of marker effects`[[3]]
    ##      [,1] [,2]       
    ## [1,] "m1" 0.1138279  
    ## [2,] "m2" -0.1585589 
    ## [3,] "m3" -0.2008508 
    ## [4,] "m4" -0.05889851
    ## [5,] "m5" -0.04203215
    ## 
    ## 
    ## $`Posterior mean of marker effects covariance matrix`
    ##             [,1]        [,2]        [,3]
    ## [1,]  0.94462080 -0.32275800 -0.04674421
    ## [2,] -0.32275800  0.67886639  0.02333844
    ## [3,] -0.04674421  0.02333844  0.48874385
    ## 
    ## $`Posterior mean of residual variance`
    ##             [,1]       [,2]        [,3]
    ## [1,]  0.78585480 -0.1776136  0.01662811
    ## [2,] -0.17761362  0.9288119 -0.08687690
    ## [3,]  0.01662811 -0.0868769  0.69001727
    ## 
    ## $`Posterior mean of marker effects variance`
    ##             [,1]        [,2]        [,3]
    ## [1,]  0.94462080 -0.32275800 -0.04674421
    ## [2,] -0.32275800  0.67886639  0.02333844
    ## [3,] -0.04674421  0.02333844  0.48874385
    ## 
    ## $`Posterior mean of location parameters`
    ##    Trait    Effect     Level    Estimate
    ## 1      1 intercept intercept    2.685988
    ## 2      1        x1        x1    1.157978
    ## 3      1        x3         m   0.9375514
    ## 4      1        x3         f  -0.9169539
    ## 5      1        ID        a2  -0.1477278
    ## 6      1        ID       a12   0.1952722
    ## 7      1        ID       a10     0.64072
    ## 8      1        ID       a11   0.1805779
    ## 9      1        ID        a9  -0.2773762
    ## 10     1        ID        a6  -0.1354178
    ## 11     1        ID        a7   0.1727276
    ## 12     1        ID        a3  0.03470737
    ## 13     1        ID        a8  -0.7707475
    ## 14     1        ID        a1  0.07711045
    ## 15     1        ID        a5   0.4649708
    ## 16     1        ID        a4   -0.462423
    ## 17     1       dam        a2   0.3110996
    ## 18     1       dam       a12 -0.01192124
    ## 19     1       dam       a10  0.07492724
    ## 20     1       dam       a11 -0.01798685
    ## 21     1       dam        a9   -0.126763
    ## 22     1       dam        a6  -0.3028791
    ## 23     1       dam        a7  0.05190596
    ## 24     1       dam        a3 -0.02327068
    ## 25     1       dam        a8 -0.08279504
    ## 26     1       dam        a1  -0.1084639
    ## 27     1       dam        a5   0.0855799
    ## 28     1       dam        a4  0.06744869
    ## 29     2 intercept intercept    10.35897
    ## 30     2        x1        x1 -0.06080383
    ## 31     2        x2         2   0.1117781
    ## 32     2        x2         1 -0.06634847
    ## 33     2        x3         m   -3.962762
    ## 34     2        x3         f   -4.795332
    ## 35     2        ID        a2    0.343826
    ## 36     2        ID       a12 0.002898132
    ## 37     2        ID       a10  -0.6706221
    ## 38     2        ID       a11  0.01423414
    ## 39     2        ID        a9   0.7122494
    ## 40     2        ID        a6   0.1472273
    ## 41     2        ID        a7  -0.1089454
    ## 42     2        ID        a3  -0.1436608
    ## 43     2        ID        a8   0.7836124
    ## 44     2        ID        a1  -0.2367267
    ## 45     2        ID        a5  -0.2569986
    ## 46     2        ID        a4   0.7495796
    ## 47     3 intercept intercept    1.989197
    ## 48     3        x1        x1    4.233378
    ## 49     3     x1*x3    x1 * m   -4.589479
    ## 50     3     x1*x3    x1 * f   -4.230307
    ## 51     3        x2         2 -0.04053175
    ## 52     3        x2         1  0.01506796
    ## 53     3        ID        a2 -0.07013584
    ## 54     3        ID       a12 -0.07111011
    ## 55     3        ID       a10   -0.307953
    ## 56     3        ID       a11 -0.05822534
    ## 57     3        ID        a9   0.2237613
    ## 58     3        ID        a6  0.07201766
    ## 59     3        ID        a7  -0.2123775
    ## 60     3        ID        a3   0.4221909
    ## 61     3        ID        a8  -0.3162486
    ## 62     3        ID        a1  -0.3513409
    ## 63     3        ID        a5  -0.4116428
    ## 64     3        ID        a4  -0.2456042
    ## 65     1  <U+03F5>        a2  -0.1020455
    ## 66     1  <U+03F5>       a12   0.1042109
    ## 67     1  <U+03F5>       a10   0.1145231
    ## 68     1  <U+03F5>       a11  0.08279053
    ## 69     1  <U+03F5>        a9  0.08799297
    ## 70     2  <U+03F5>        a2  -0.0786328
    ## 71     2  <U+03F5>       a12  -0.0388525
    ## 72     2  <U+03F5>       a10  -0.3538358
    ## 73     2  <U+03F5>       a11 -0.01230819
    ## 74     2  <U+03F5>        a9   0.2758119
    ## 75     3  <U+03F5>        a2  0.01605263
    ## 76     3  <U+03F5>       a12   0.2193259
    ## 77     3  <U+03F5>       a10  0.06144691
    ## 78     3  <U+03F5>       a11   0.2076696
    ## 79     3  <U+03F5>        a9   0.3497837
    ## 80     1         J         J    5.102267
    ## 81     2         J         J    1.588139
    ## 82     3         J         J    2.366806
    ## 
    ## $`Posterior mean of Pi`
    ## $`Posterior mean of Pi`$`[1.0, 1.0, 0.0]`
    ## [1] 0.1691165
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 0.0, 0.0]`
    ## [1] 0.1071379
    ## 
    ## $`Posterior mean of Pi`$`[1.0, 0.0, 0.0]`
    ## [1] 0.124898
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 1.0, 1.0]`
    ## [1] 0.1078377
    ## 
    ## $`Posterior mean of Pi`$`[1.0, 0.0, 1.0]`
    ## [1] 0.119389
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 0.0, 1.0]`
    ## [1] 0.1052929
    ## 
    ## $`Posterior mean of Pi`$`[1.0, 1.0, 1.0]`
    ## [1] 0.1577382
    ## 
    ## $`Posterior mean of Pi`$`[0.0, 1.0, 0.0]`
    ## [1] 0.1085897
