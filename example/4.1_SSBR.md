4.1\_SSBR
================
Tianjing Zhao
August 27, 2018

### Install package

``` r
library(devtools)
install_github("zhaotianjing/JWASr")
```

    ## Skipping install of 'JWASr' from a github remote, the SHA1 (b5b65317) has not changed since last install.
    ##   Use `force = TRUE` to force installation

### set up (windows user)

``` r
path_libjulia = "C:/Users/ztjsw/AppData/Local/Julia-0.7.0/bin/libjulia.dll"
JWASr::jwasr_setup_win(path_libjulia)
```

    ## Julia version 0.7.0 at location C:\Users\ztjsw\AppData\Local\JULIA-~2.0\bin will be used.

    ## Loading setup script for JuliaCall...

    ## Finish loading setup script for JuliaCall.

For Mac user, run one line "JWASr::jwasr\_setup()" to setup.

### data

``` r
phenotypes = JWASr::phenotypes

ped_path = "D:\\JWASr\\data\\pedigree.txt"
JWASr::get_pedigree(ped_path, separator=',', header=T)  #build "pedigree" in Julia
```

    ## JWAS.PedModule.Pedigree(13, Dict{AbstractString,JWAS.PedModule.PedNode}("a2"=>PedNode(1, "0", "0", 0.0),"a1"=>PedNode(2, "0", "0", 0.0),"a7"=>PedNode(4, "a1", "a3", 0.0),"a12"=>PedNode(10, "a9", "a10", 0.1875),"a5"=>PedNode(8, "a1", "a2", 0.0),"a3"=>PedNode(3, "0", "0", 0.0),"a4"=>PedNode(5, "a1", "a2", 0.0),"a6"=>PedNode(6, "a1", "a3", 0.0),"a10"=>PedNode(9, "a5", "a7", 0.125),"a11"=>PedNode(11, "a9", "a10", 0.1875)), Dict(32=>0.25,2=>0.0,16=>0.0,11=>0.5,7=>0.0,9=>0.5,25=>0.375,35=>0.375,43=>0.375,19=>0.5), Set(Any[]), Set(Any[]), Set(Any[]), Set(Any[]))

### build model

``` r
model_equation = "y1 = intercept + x1*x3 + x2 + x3 + ID + dam";
R = 1.0
model = JWASr::build_model(model_equation,R) #build "model" in Julia
```

### set covariate

``` r
JWASr::ran_julia('set_covariate(model,"x1")')
```

    ## 1-element Array{Symbol,1}:
    ##  :x1

### set random

``` r
JWASr::assign("G1", 1.0)
JWASr::ran_julia('set_random(model,"x2",G1)')
```

``` r
JWASr::assign("G2",diag(2))
JWASr::ran_julia('set_random(model,"ID dam",pedigree,"G2")')
```

### add genotypes

``` r
G3 = 1.0
geno_path = "D:/JWASr/data/genotypes.txt"

JWASr::add_genotypes(geno_path, G3)  #separator=',' is default
```

### run

``` r
JWASr::ran_julia('outputEBV(model,["a1","a2","a3"]);')
```

``` r
JWASr::ran_julia("outputMCMCsamples(model,x2)")
out = JWASr::runMCMC(data = phenotypes, methods = "RR-BLUP",single_step_analysis = TRUE,
                     pedigree=TRUE, chain_length = 5000, output_samples_frequency = 100,outputEBV = TRUE)  #pedigree=TRUE: pedigree; FALSE: false
out
```

    ## $EBV_y1
    ##      [,1] [,2]     
    ## [1,] "a1" -19.14026
    ## [2,] "a2" -9.556149
    ## [3,] "a3" -19.14246
    ## 
    ## $`Posterior mean of marker effects`
    ##      [,1] [,2]        
    ## [1,] "m1" 0.007020354 
    ## [2,] "m2" -0.01829742 
    ## [3,] "m3" 0.01425874  
    ## [4,] "m4" -0.01128578 
    ## [5,] "m5" -0.006235235
    ## 
    ## $`Posterior mean of residual variance`
    ## [1] 0.9718383
    ## 
    ## $`Posterior mean of marker effects variance`
    ## [1] 0.4238133
    ## 
    ## $`Posterior mean of location parameters`
    ##    Trait    Effect     Level      Estimate
    ## 1      1 intercept intercept      16.80354
    ## 2      1     x1*x3    x1 * m      23.26569
    ## 3      1     x1*x3    x1 * f      11.36697
    ## 4      1        x2         2    -0.1047982
    ## 5      1        x2         1   -0.02328481
    ## 6      1        x3         m     -39.77693
    ## 7      1        x3         f     -22.20347
    ## 8      1        ID        a1      21.21065
    ## 9      1        ID        a2      10.96892
    ## 10     1        ID        a3      14.60163
    ## 11     1        ID        a4      93.70711
    ## 12     1        ID        a5      103.3614
    ## 13     1        ID        a6      -11.7334
    ## 14     1        ID        a7      37.87967
    ## 15     1        ID        a8     -55.44681
    ## 16     1        ID        a9     -55.88981
    ## 17     1        ID       a10      87.15772
    ## 18     1       dam         0           NaN
    ## 19     1       dam        a2      -68.1704
    ## 20     1       dam        a3     -19.57148
    ## 21     1       dam        a6      85.99493
    ## 22     1       dam        a7     -47.76084
    ## 23     1  <U+03F5>        a2   0.004441521
    ## 24     1  <U+03F5>       a12   0.006309884
    ## 25     1  <U+03F5>       a10 -0.0003958928
    ## 26     1  <U+03F5>       a11    0.01034233
    ## 27     1  <U+03F5>        a9   -0.00313748
    ## 28     1         J         J      19.13759
